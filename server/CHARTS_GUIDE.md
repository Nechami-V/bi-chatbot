# מדריך לגרפים חכמים במערכת BI Chatbot

## סוגי גרפים אוטומטיים

המערכת מזהה אוטומטית את סוג הגרף המתאים על בסיס:
1. **תוכן השאלה** - מילות מפתח שמעידות על כוונת המשתמש
2. **מבנה הנתונים** - סוג העמודות (מספרי/קטגורי) וכמות השורות
3. **הקשר העסקי** - דוגמה: "מובילים" יציג בסדר יורד

---

## 📊 1. גרף עמודות (Bar Chart)
**מתי**: השוואה בין קטגוריות, מיון לפי ערך

### דוגמאות שאלות:
- "מי הלקוחות הכי רווחיים?" → יראה את הלקוחות ממוינים לפי סכום
- "כמות הזמנות לפי עיר" → עמודות של כל עיר
- "מכירות לפי שבוע" → עמודות של סכומים
- "טופ 10 מוצרים" → 10 העמודות הגבוהות ביותר

### מילות מפתח שמפעילות גרף עמודות:
- "מובילים", "הכי", "טופ", "רווחיים", "גדולים", "קטנים"
- "top", "best", "most", "least", "highest", "lowest"

### תכונות:
- ✅ ממוין אוטומטית לפי ערך (בשאלות "מובילים")
- ✅ מוגבל ל-20 תוצאות מובילות
- ✅ צבעים שונים לכל עמודה
- ✅ פורמט מספרים בעברית (כולל קיצורים: 1M, 500K)

---

## 🥧 2. גרף עוגה (Pie Chart)
**מתי**: התפלגות, אחוזים, יחסים

### דוגמאות שאלות:
- "כמה לקוחות יש בירושלים ביחס לכל הארץ?" → עוגה של ירושלים vs שאר הערים
- "התפלגות מכירות לפי קבוצת מוצרים" → פלחי עוגה
- "אחוז הלקוחות בכל עיר" → כל עיר = פלח
- "יחס המכירות בין השבועות" → השוואת שבועות

### מילות מפתח שמפעילות גרף עוגה:
- "יחס", "אחוז", "שיעור", "התפלגות", "חלוקה"
- "percentage", "ratio", "distribution", "proportion"

### תכונות:
- ✅ מוגבל ל-10 פלחים (השאר מצטברים ל"אחרים")
- ✅ מציג אחוזים בכל פלח
- ✅ Legend עם אחוזים בעברית (RTL)
- ✅ Tooltip עם ערך מוחלט + אחוז

---

## 📈 3. גרף קו (Line Chart)
**מתי**: מגמות לאורך זמן, טרנדים

### דוגמאות שאלות:
- "מגמת המכירות לפי תאריך" → קו של סכומים על ציר הזמן
- "כמה הזמנות היו בכל שבוע?" → קו של כמויות
- "טרנד ההכנסות ב-6 חודשים האחרונים" → קו עם נקודות
- "שינוי במספר לקוחות לאורך השנה" → קו זמן

### מילות מפתח שמפעילות גרף קו:
- "מגמה", "לאורך", "טרנד", "זמן", "תקופה"
- "trend", "over time", "timeline", "evolution"

### תכונות:
- ✅ זיהוי אוטומטי של עמודות תאריך
- ✅ קו חלק (tension=0.2)
- ✅ נקודות על הקו לראות ערכים

---

## 🔢 4. מטריקה (Metric / KPI)
**מתי**: ערך בודד, סכום, ספירה

### דוגמאות שאלות:
- "כמה לקוחות יש לי?" → מספר גדול: 63,186
- "סה\"כ מכירות השנה" → סכום: ₪2,450,000
- "מספר הזמנות היום" → ספירה: 1,234

### מילות מפתח שמפעילות מטריקה:
- "כמה", "מספר", "כמות", "סה\"כ", "סך הכל"
- "how many", "count", "total", "sum"

### תכונות:
- ✅ תצוגה גדולה וברורה
- ✅ כותרת מתארת ("סה\"כ לקוחות")
- ✅ פורמט מספרים עם פסיקים

---

## 🎯 דוגמאות מעשיות

### תרחיש 1: ניתוח לקוחות רווחיים
**שאלה**: "תן לי את 5 הלקוחות הכי רווחיים"

**גרף שיוצר**: Bar Chart (עמודות)
- X: שמות הלקוחות (5 העליונים)
- Y: סכום מכירות (ממוין יורד)
- כותרת: "total_amount - מובילים"

---

### תרחיש 2: התפלגות גיאוגרפית
**שאלה**: "כמה אחוז מהלקוחות נמצאים בירושלים?"

**גרף שיוצר**: Pie Chart (עוגה)
- פלח 1: ירושלים (X%)
- פלח 2: תל אביב (Y%)
- פלח 3: חיפה (Z%)
- וכו'...

---

### תרחיש 3: מגמות מכירות
**שאלה**: "הראה לי את המגמה של המכירות לפי חודש"

**גרף שיוצר**: Line Chart (קו)
- X: חודשים (ינואר, פברואר, מרץ...)
- Y: סכום מכירות
- קו חלק שמראה עליה/ירידה

---

### תרחיש 4: ספירה כוללת
**שאלה**: "כמה לקוחות יש במערכת?"

**גרף שיוצר**: Metric (מספר גדול)
```
    סה"כ לקוחות
    
       63,186
```

---

## 💡 טיפים לשאלות טובות

### ✅ טוב:
- "10 המוצרים הנמכרים ביותר" → ברור שצריך Bar ממוין
- "יחס הלקוחות בין הערים" → ברור שצריך Pie
- "מכירות לפי חודש ב-2024" → ברור שצריך Line

### ❌ פחות טוב:
- "לקוחות" → לא ברור מה רוצים
- "מכירות" → צריך להוסיף "לפי..." או "טרנד..."

---

## 🔧 התאמות טכניות

### הגבלות:
- **Bar Chart**: מקסימום 20 תוצאות
- **Pie Chart**: מקסימום 10 פלחים (השאר ב"אחרים")
- **Line Chart**: ללא הגבלה (אבל עדיף עד 50 נקודות)

### צבעים:
```
#7C3AED (סגול)
#F59E0B (כתום)
#4F46E5 (כחול-סגול)
#10B981 (ירוק)
#EF4444 (אדום)
#06B6D4 (תכלת)
#F97316 (כתום-אדום)
#8B5CF6 (סגול-בהיר)
#EC4899 (ורוד)
#14B8A6 (טורקיז)
```

---

## 🚀 כיצד זה עובד?

1. **המשתמש שואל שאלה** בעברית או אנגלית
2. **AI מייצר SQL** מתאים לשאלה
3. **המערכת מריצה את ה-SQL** ומקבלת תוצאות
4. **אלגוריתם חכם** בודק:
   - מילות מפתח בשאלה
   - מבנה הנתונים (כמה עמודות, אילו טיפוסים)
   - הקשר (האם זה ספירה, השוואה, מגמה...)
5. **נבחר סוג הגרף המתאים**
6. **הגרף מוצג** בצד הצ'אט עם כל התכונות

---

## 📋 סיכום מילות מפתח

| סוג גרף | מילות מפתח עבריות | מילות מפתח אנגליות |
|---------|-------------------|---------------------|
| **Bar** | מובילים, הכי, טופ, רווחיים | top, best, most, highest |
| **Pie** | יחס, אחוז, התפלגות, חלוקה | percentage, ratio, distribution |
| **Line** | מגמה, טרנד, לאורך זמן | trend, over time, timeline |
| **Metric** | כמה, סה"כ, מספר, כמות | how many, count, total |

